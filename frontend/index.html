<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synthonnel</title>
    <link rel="stylesheet" href="dragula.min.css" />
    <style>
        #drag-elements {
            display: flex; /* Use flexbox to align children horizontally */
            gap: 10px; /* Optional: adds some space between items */
        }
        #drag-elements div {
            flex: 1; /* Allows each item to grow to fill the container */
            text-align: center; /* Center the text inside each item */
            border: 1px solid #ccc; /* Optional: adds a border around each item */
            padding: 10px; /* Optional: adds some padding inside each item */
            background-color: #f0f0f0; /* Optional: adds a background color */
            cursor: grab; /* Changes the cursor to indicate items can be moved */
        }
        /* Add styling for when you're dragging an item */
        .gu-mirror {
            list-style: none;
            margin: 0;
            padding: 0;
            z-index: 9999;
            opacity: 0.8;
        }
        .gu-hide {
            display: none !important;
        }
        .gu-unselectable {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
        }
        .gu-transit {
            opacity: 0.2;
        }
        #addItemBtn {
            cursor: pointer;
            /* Add more styling here */
        }

        #addItemForm {
            /* Ensure the form is visually distinct and easy to use */
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #drag-elements div {
            display: flex; /* Enables flexbox layout */
            align-items: center; /* Centers items vertically */
            justify-content: center; /* Centers the item title horizontally */
            position: relative; /* Allows absolute positioning inside */
        }
        .handle {
            position: absolute;
            left: 0; /* Positions handle at the left */
            top: 0; /* Positions handle at the top */
            cursor: grab;
        }
        .item-title {
            text-align: center; /* Ensures the title text is centered */
            flex-grow: 1; /* Allows the title to fill the space */
        }

    </style>
</head>
<body>
    <h1>- = chat history here = -</h1>
    <div id="drag-elements">
        <div class="item" 
            data-provider="Provider1" 
            data-model="Model1" 
            data-parameters="temperature=1.1\nmax_tokens=1000" 
            data-providerurl="http://localhost:8000" 
            data-apikey="API111KEY111" 
            >
            <span class="handle">☰</span> <div class="itemTitle">Provider One</div>
        </div>
        <div class="item" 
            data-provider="Provider2" 
            data-model="Model2" 
            data-parameters="temperature=2.2\nmax_tokens=2000" 
            data-providerurl="http://localhost:8000" 
            data-apikey="API222KEY222" 
            >
            <span class="handle">☰</span> <div class="itemTitle">Provider Two</div>
        </div>
    </div>

    <!-- Add Item Button -->
    <button id="addItemBtn" style="position: fixed; right: 20px; bottom: 20px;">Add Item</button>

    <!-- Hidden form for adding items -->
    <div id="addItemForm" style="display: none; position: fixed; right: 20px; bottom: 80px; background: white; padding: 10px; border: 1px solid #ccc;">
        <input type="text" id="newItemProvider" placeholder="Provider">
        <input type="text" id="newItemModel" placeholder="Model">
        <input type="text" id="newItemParameters" placeholder="Parameters">
        <input type="text" id="newItemProviderUrl" placeholder="ProviderUrl">
        <input type="text" id="newItemApiKey" placeholder="ApiKey">
        <button id="confirmAddItem">Add</button>
    </div>

    <script src="dragula.min.js"></script>
    <script>
        // Initialize Dragula
        var drake = dragula([document.getElementById('drag-elements')], {
            moves: function (el, container, handle) {
                return handle.classList.contains('handle');
            }
            });

        drake.on('drop', (el, target) => {
            saveItems();
        });
    </script>

    <script>
        document.getElementById('addItemBtn').onclick = function() {
            document.getElementById('addItemForm').style.display = 'block';
        };

        document.getElementById('confirmAddItem').onclick = async function() {
            const newItemProvider = document.getElementById('newItemProvider').value.trim();
            const newItemModel = document.getElementById('newItemModel').value.trim();
            const newItemParameters = document.getElementById('newItemParameters').value.trim();
            const newItemProviderUrl = document.getElementById('newItemProviderUrl').value.trim();
            const newItemApiKey = document.getElementById('newItemApiKey').value.trim();
            
            if (newItemProvider && newItemModel && newItemProviderUrl && newItemApiKey) {
                const newItem = document.createElement('div');

                const newItemHTML = `
                    <div class="item" 
                        data-provider="${newItemProvider}" 
                        data-model="${newItemModel}" 
                        data-parameters="${newItemParameters}" 
                        data-providerurl="${newItemProviderUrl}" 
                        data-apikey="${newItemApiKey}" 
                        >
                        <span class="handle">☰</span> <div class="itemTitle">${newItemProvider}</div>
                    </div>
                `;

                newItem.innerHTML = newItemHTML;
                document.getElementById('drag-elements').appendChild(newItem);
                
                // Reset form
                // document.getElementById('newItemTitle').value = '';
                // document.getElementById('newItemProvider').value = '';
                // document.getElementById('newItemModel').value = '';
                // document.getElementById('newItemTemperature').value = '';
                // document.getElementById('addItemForm').style.display = 'none';

                saveItems();

            }
        };

        async function saveItems() {
            const items = Array.from(document.querySelectorAll('#drag-elements .item')).map(div => ({
                provider: div.dataset.provider,
                model: div.dataset.model,
                parameters: div.dataset.parameters,
                providerurl: div.dataset.providerurl,
                apikey: div.dataset.apikey,
            }));

            fetch('http://localhost:8000/save-items', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(items),
            });
        }
    </script>
</body>
</html>
